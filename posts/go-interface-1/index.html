<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Go interface 详解(一) ：介绍 · Go Tutorial</title><meta name="description" content="Go interface 详解(一) ：介绍 - wecatch"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/go/favicon.ico"><link rel="stylesheet" href="/go/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://wecatch.me/go/atom.xml" title="Go Tutorial"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">Go Tutorial</h2></a></div><a href="/go/" target="_self" class="li component-nav-item"><p>首页</p></a><a href="/go/categories/basic/" target="_self" class="li component-nav-item"><p>基础概念</p></a><a href="/go/categories/advanced/" target="_self" class="li component-nav-item"><p>高级主题</p></a><a href="/go/categories/practice/" target="_self" class="li component-nav-item"><p>最佳实践</p></a><a href="/go/book" target="_self" class="li component-nav-item"><p>书籍推荐</p></a><a href="/go/categories/projects/" target="_self" class="li component-nav-item"><p>开源项目</p></a></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">Go interface 详解(一) ：介绍</h1><div class="post-info">Oct 10, 2017</div><div class="post-content"><blockquote>
<p>本系列是阅读 “The Go Programming Language” 理解和记录。</p>
</blockquote>
<p>Go 中的 interface 是一种类型，更准确的说是一种抽象类型 abstract type，一个 interface 就是包含了一系列行为的 method 集合，interface 的定义很简单：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">    Write(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go 中的 interface 不同于其它语言，它是隐式的 implicitly，这意味着对于一个已有类型，你可以不用更改任何代码就可以让其满足某个 interface。</p>
<p>如果一个 concrete type 实现了某个 interface，我们说这个 concrete type 实现了 interface 包含的所有 method，<strong>必须是所有的 method</strong>。</p>
<p>在 Go 的标准库 <code>fmt</code> 中有一系列的方法可以很好的诠释 interface 是如何应用到实践当中的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fmt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fprintf</span><span class="params">(w io.Writer, format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">Printf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Fprintf(os.Stdout, format, args...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sprintf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">    Fprintf(&amp;buf, format, args...)</span><br><span class="line">    <span class="keyword">return</span> buf.String()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Fprintf</code> 中的前缀 <code>F</code> 表示 <code>File</code>，意思是格式化的输出被输出到函数指定的第一个 <code>File</code> 类型的参数中。</p>
<p>在 <code>Printf</code> 函数中，调用 <code>Fprintf</code> 时指定的输出是标准输出，这正是 <code>Printf</code> 的功能：Printf formats according to a format specifier and writes to standard output，根据指定的格式化要求输出到标准输出，<code>os.Stdout</code> 的类型是 <code>*os.File</code> 。</p>
<p>同样在 <code>Sprintf</code> 函数中，调用 <code>Fprintf</code> 时指定的输出是一个指向某个 memory buffer 的指针，其类似一个 <code>*os.File</code>。</p>
<p>虽然 <code>bytes.Buffer</code> 和 <code>os.Stdout</code> 是不同的，但是它们都可以被用于调用同一个函数 <code>Fprintf</code>，就是因为 <code>Fprintf</code> 的第一个参数是接口类型 <code>io.Writer</code> ，而 <code>bytes.Buffer</code> 和 <code>os.Stdout</code> 都实现了这个 interface，即它们都实现了 <code>Write</code> 这个 method，这个 interface 并不是一个 <code>File</code> 却完成了类似 <code>File</code>的功能。</p>
<p><code>Fprintf</code> 其实并不关心它的第一个参数是一个 file 还是一段 memory，它只是调用了 <code>Write</code> method。这正是 interface 所关注的，<strong>只在乎行为，不在乎其值</strong>，这种能力让我们可以非常自由的向 <code>Fprintf</code> 传递任何满足 <code>io.Writer</code> 的 concrete type，这是 Go interface 带来的 <code>substitutability</code> 可替代性，object-oriented programming 的一种重要特性。</p>
<p>看个例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ByteCounter <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ByteCounter)</span> <span class="title">Write</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">    *c += ByteCounter(<span class="built_in">len</span>(p)) <span class="comment">// convert int to ByteCounter</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(p), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> c ByteCounter</span><br><span class="line">    c.Write([]<span class="keyword">byte</span>(<span class="string">"hello"</span>))</span><br><span class="line">    fmt.Println(c) <span class="comment">// 5  #1</span></span><br><span class="line">    fmt.Fprintf(&amp;c, <span class="string">"hello"</span>) #<span class="number">2</span> </span><br><span class="line">    fmt.Println(c) <span class="comment">// 10  #3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ByteCounter</code> 实现了 <code>Write</code> method，它满足 <code>io.Writer</code> interface，<code>Write</code> method 计算传给它的 byte slice 的长度并且赋值给自身，所以 <code>#1</code> 输出到标准输出的是它的值 5，正如前文所言，调用 <code>fmt.Fprintf</code> 时再次调用了 c 的 <code>Write</code> method，所以 <code>#3</code> 输出是 10。</p>
<p>这就是 Go 中的 interface 所具有的最基本的功能：作为一种 abstract type，实现各种 concrete type 的行为统一。</p>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/go/posts/go-interface-2/" class="prev">上一篇</a><a href="/go/posts/go-o-o/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://wecatch.me/go">wecatch</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p><p>本站文章遵循 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">Creative Commons BY-NC-ND 4.0（自由转载-保持署名-非商用-禁止演绎）</a></p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-79591400-1",'auto');ga('send','pageview');</script></body></html>